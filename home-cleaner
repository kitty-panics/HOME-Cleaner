#!/usr/bin/env bash

#
# 清理家目录中的垃圾文件、历史记录
#

# APP Disable/Enable Rule Directory
PATH_DISABLE="$HOME/*******/*******/HOME-Cleaner/app.disable"
PATH_ENABLE="$HOME/*******/*******/HOME-Cleaner/app.enable"

# 单一文件 (Single File)
Single_File() {
    echo -e "$1" | awk -F '^SF\\|\\|' '{print $2}' |
    while read -r LINE; do
        rm -rf "$HOME/$LINE"
    done
}

# 多个规律文件 (Rule File)
Rule_File() {
    echo -e "$1" | awk -F '^RF\\|\\|' '{print $2}' |
    while read -r LINE; do
        ls "$HOME"/`echo -e "$LINE" | sed 's/\ /\\\ /g'` 2>/dev/null | cat | while read -r LINE; do
            rm -rf "$LINE"
        done
    done
}

# 只删目录 (DeleteOnly Dir)
Deleteonly_Dir() {
    echo -e "$1" | awk -F '^DD\\|\\|' '{print $2}' |
    while read -r LINE; do
        rm -rf "$HOME/$LINE"
    done
}

# 需重建目录 (Recreate Dir)
Recreate_Dir() {
    echo -e "$1" | awk -F '^RD\\|\\|' '{print $2}' |
    while read -r LINE; do
        rm -rf "$HOME/$LINE"
        mkdir -p "$HOME/$LINE"
    done
}

# Shell 命令 (Shell Command) (主要用于删除历史记录)
Shell_Command() {
    echo -e "$1" | awk -F '^SC\\|\\|' '{print $2}' |
    while read -r LINE; do
        bash -c "$LINE"
    done
}

# 遍历 APP 规则
find "$PATH_ENABLE" -maxdepth 1 -type f | while read -r LINE
do
    # 单一文件 (Single File)
    SF_RULE=$(grep '^SF||' "$LINE")
    if [[ "$?" == "0" ]]; then
        Single_File "$SF_RULE"
    fi

    # 多个规律文件 (Rule File)
    RF_RULE=$(grep '^RF||' "$LINE")
    if [[ "$?" == "0" ]]; then
        Rule_File "$RF_RULE"
    fi

    # 只删目录 (DeleteOnly Dir)
    DD_RULE=$(grep '^DD||' "$LINE")
    if [[ "$?" == "0" ]]; then
        Deleteonly_Dir "$DD_RULE"
    fi

    # 需重建目录 (Recreate Dir)
    RD_RULE=$(grep '^RD||' "$LINE")
    if [[ "$?" == "0" ]]; then
        Recreate_Dir "$RD_RULE"
    fi

    # Shell 命令 (Shell Command) (主要用于删除历史记录)
    SC_RULE=$(grep '^SC||' "$LINE")
    if [[ "$?" == "0" ]]; then
        Shell_Command "$SC_RULE"
    fi
done
